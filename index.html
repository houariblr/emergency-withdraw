<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeFi Rescue â€” Recover Your Funds</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Tajawal:wght@300;400;500;700;800&family=DM+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --bg: #060810;
            --surface: #0d1020;
            --surface2: #141728;
            --border: #1e2340;
            --accent: #4fffb0;
            --accent2: #00c8ff;
            --warn: #ffb344;
            --danger: #ff4f6a;
            --text: #e8eaf0;
            --muted: #6b7090;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        body.lang-en { font-family: 'DM Sans', sans-serif; }
        body.lang-ar { font-family: 'Tajawal', sans-serif; }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(rgba(79,255,176,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(79,255,176,0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .orb { position: fixed; border-radius: 50%; filter: blur(120px); opacity: 0.12; pointer-events: none; z-index: 0; }
        .orb1 { width: 500px; height: 500px; background: var(--accent); top: -200px; left: -200px; }
        .orb2 { width: 400px; height: 400px; background: var(--accent2); bottom: -150px; right: -150px; }

        /* ---- Language Toggle ---- */
        .lang-bar {
            position: fixed;
            top: 16px; right: 20px;
            z-index: 100;
            display: flex;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 50px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        html[dir="rtl"] .lang-bar { right: auto; left: 20px; }

        .lang-btn {
            padding: 7px 18px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--muted);
            transition: all 0.2s;
            letter-spacing: 0.5px;
        }
        body.lang-en .lang-btn { font-family: 'DM Sans', sans-serif; }
        body.lang-ar .lang-btn { font-family: 'Tajawal', sans-serif; }
        .lang-btn.active { background: rgba(79,255,176,0.12); color: var(--accent); }

        /* ---- i18n visibility ---- */
        .en { display: inline; }
        .ar { display: none; }
        body.lang-ar .en { display: none; }
        body.lang-ar .ar { display: inline; }
        .en-block { display: block; }
        .ar-block { display: none; }
        body.lang-ar .en-block { display: none; }
        body.lang-ar .ar-block { display: block; }

        /* ---- Layout ---- */
        .container { position: relative; z-index: 1; max-width: 720px; margin: 0 auto; padding: 30px 20px 60px; }

        header { text-align: center; padding: 70px 20px 40px; animation: fadeDown 0.6s ease both; }

        .logo-badge {
            display: inline-flex; align-items: center; gap: 10px;
            background: rgba(79,255,176,0.08); border: 1px solid rgba(79,255,176,0.2);
            border-radius: 50px; padding: 8px 20px;
            font-family: 'Space Mono', monospace; font-size: 0.72rem;
            color: var(--accent); letter-spacing: 2px; margin-bottom: 24px; text-transform: uppercase;
        }

        .live-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent); animation: pulse 2s ease infinite; }
        @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }

        h1 {
            font-size: clamp(1.9rem, 5vw, 2.9rem); font-weight: 800; line-height: 1.15; margin-bottom: 16px;
            background: linear-gradient(135deg, #fff 0%, var(--accent) 60%, var(--accent2) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }

        .subtitle { color: var(--muted); font-size: 1.05rem; font-weight: 300; max-width: 500px; margin: 0 auto; line-height: 1.7; }

        .trust-strip { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 28px 0; animation: fadeUp 0.7s 0.2s ease both; }

        .badge {
            display: flex; align-items: center; gap: 7px;
            background: rgba(79,255,176,0.06); border: 1px solid rgba(79,255,176,0.15);
            border-radius: 50px; padding: 7px 16px; font-size: 0.82rem; color: var(--accent); font-weight: 500;
        }
        .badge .dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent); flex-shrink: 0; }

        /* ---- Info Banner ---- */
        .info-banner {
            background: rgba(255,179,68,0.06); border: 1px solid rgba(255,179,68,0.2);
            border-radius: 12px; padding: 18px 22px; margin-bottom: 24px;
            display: flex; gap: 14px; align-items: flex-start; animation: fadeUp 0.7s 0.3s ease both;
        }
        .info-banner .ico { font-size: 1.3rem; flex-shrink: 0; margin-top: 2px; }
        .info-banner h4 { color: var(--warn); font-size: 0.95rem; margin-bottom: 6px; font-weight: 700; }
        .info-banner p { color: #a89060; font-size: 0.87rem; line-height: 1.65; }

        /* ---- Cards ---- */
        .card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 16px; padding: 28px; margin-bottom: 20px;
            position: relative; overflow: hidden; animation: fadeUp 0.6s ease both;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(79,255,176,0.3), transparent);
        }

        .card-header { display: flex; align-items: center; gap: 14px; margin-bottom: 22px; }

        .step-num {
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(79,255,176,0.1); border: 1px solid rgba(79,255,176,0.3);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Space Mono', monospace; font-size: 0.85rem;
            color: var(--accent); font-weight: 700; flex-shrink: 0; transition: all 0.3s;
        }
        .step-num.done { background: rgba(79,255,176,0.2); border-color: var(--accent); }
        .card-header h2 { font-size: 1.1rem; font-weight: 700; color: #fff; }
        .card-header p { font-size: 0.82rem; color: var(--muted); margin-top: 3px; }

        /* ---- Network ---- */
        .network-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
        .net-btn {
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: 10px; padding: 14px 8px; text-align: center;
            cursor: pointer; transition: all 0.2s; color: var(--muted); font-size: 0.83rem; font-weight: 500;
        }
        body.lang-en .net-btn { font-family: 'DM Sans', sans-serif; }
        body.lang-ar .net-btn { font-family: 'Tajawal', sans-serif; }
        .net-btn .net-icon { font-size: 1.5rem; display: block; margin-bottom: 6px; }
        .net-btn:hover, .net-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(79,255,176,0.05); }
        .net-btn.active { box-shadow: 0 0 0 1px var(--accent); }

        /* ---- Buttons ---- */
        .btn {
            width: 100%; padding: 14px 24px; border: none; border-radius: 10px;
            font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.25s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        body.lang-en .btn { font-family: 'DM Sans', sans-serif; }
        body.lang-ar .btn { font-family: 'Tajawal', sans-serif; }

        .btn-primary { background: linear-gradient(135deg, var(--accent), #00d9b0); color: #060810; }
        .btn-primary:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(79,255,176,0.3); }
        .btn-primary:disabled { opacity: 0.35; cursor: not-allowed; transform: none; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-outline:hover:not(:disabled) { border-color: var(--accent2); color: var(--accent2); }
        .btn-outline:disabled { opacity: 0.35; cursor: not-allowed; }

        /* ---- Wallet info ---- */
        .wallet-info {
            background: rgba(79,255,176,0.05); border: 1px solid rgba(79,255,176,0.15);
            border-radius: 10px; padding: 16px 18px; margin-top: 16px; display: none;
        }
        .wallet-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.87rem; }
        .wallet-row + .wallet-row { margin-top: 8px; }
        .wallet-label { color: var(--muted); }
        .wallet-value { font-family: 'Space Mono', monospace; color: var(--accent); font-size: 0.78rem; }

        /* ---- Input ---- */
        .input-group { margin-bottom: 16px; }
        .input-label { font-size: 0.83rem; color: var(--muted); margin-bottom: 8px; display: block; }
        input, select {
            width: 100%; padding: 13px 16px;
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: 10px; color: var(--text); font-size: 0.93rem;
            transition: border-color 0.2s; outline: none;
        }
        body.lang-en input, body.lang-en select { font-family: 'DM Sans', sans-serif; }
        body.lang-ar input, body.lang-ar select { font-family: 'Tajawal', sans-serif; }
        input:focus, select:focus { border-color: var(--accent); }
        input::placeholder { color: var(--muted); }
        select option { background: var(--surface2); }

        /* ---- Contract list ---- */
        .contract-list { margin-top: 16px; }
        .contract-item {
            background: var(--surface2); border: 1px solid var(--border);
            border-radius: 10px; padding: 14px 16px; margin-bottom: 10px;
            cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; justify-content: space-between; gap: 12px;
        }
        .contract-item:hover, .contract-item.selected { border-color: var(--accent); background: rgba(79,255,176,0.04); }
        .contract-item.selected { box-shadow: 0 0 0 1px var(--accent); }
        .contract-addr { font-family: 'Space Mono', monospace; font-size: 0.74rem; color: var(--accent2); word-break: break-all; }
        .contract-lbl { font-size: 0.72rem; color: var(--muted); margin-bottom: 4px; }
        .contract-arrow { color: var(--muted); font-size: 1.2rem; flex-shrink: 0; }

        /* ---- Loading ---- */
        .loading { text-align: center; padding: 30px; display: none; }
        .spinner { width: 38px; height: 38px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 14px; }
        .loading p { color: var(--muted); font-size: 0.87rem; }

        /* ---- Fee box ---- */
        .fee-box { background: rgba(0,200,255,0.05); border: 1px solid rgba(0,200,255,0.15); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .fee-box h4 { color: var(--accent2); font-size: 0.93rem; margin-bottom: 14px; display: flex; align-items: center; gap: 8px; }
        .fee-row { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .fee-row:last-child { border-bottom: none; font-weight: 700; color: #fff; }
        .fee-key { color: var(--muted); }
        .fee-val { font-family: 'Space Mono', monospace; color: var(--accent); }

        /* ---- Status ---- */
        .status-msg { padding: 14px 18px; border-radius: 10px; font-size: 0.88rem; margin-top: 14px; display: none; line-height: 1.6; white-space: pre-line; }
        .status-msg.success { background: rgba(79,255,176,0.08); border: 1px solid rgba(79,255,176,0.25); color: var(--accent); }
        .status-msg.error   { background: rgba(255,79,106,0.08);  border: 1px solid rgba(255,79,106,0.25);  color: var(--danger); }
        .status-msg.info    { background: rgba(0,200,255,0.06);   border: 1px solid rgba(0,200,255,0.2);    color: var(--accent2); }

        /* ---- Donate ---- */
        .donate-section { background: rgba(79,255,176,0.04); border: 1px dashed rgba(79,255,176,0.22); border-radius: 12px; padding: 22px; margin-top: 20px; text-align: center; }
        .donate-section h4 { color: var(--accent); font-size: 1rem; margin-bottom: 8px; }
        .donate-section p { color: var(--muted); font-size: 0.85rem; margin-bottom: 14px; line-height: 1.6; }
        .btn-donate { background: rgba(79,255,176,0.1); border: 1px solid rgba(79,255,176,0.3); border-radius: 8px; padding: 12px 24px; color: var(--accent); font-size: 0.9rem; font-weight: 700; cursor: pointer; width: 100%; transition: all 0.2s; margin-top: 10px; }
        body.lang-en .btn-donate { font-family: 'DM Sans', sans-serif; }
        body.lang-ar .btn-donate { font-family: 'Tajawal', sans-serif; }
        .btn-donate:hover:not(:disabled) { background: rgba(79,255,176,0.18); transform: translateY(-1px); }
        .btn-donate:disabled { opacity: 0.35; cursor: not-allowed; }

        /* ---- Disclaimer ---- */
        .disclaimer { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 22px; margin-top: 24px; font-size: 0.82rem; color: var(--muted); line-height: 1.8; }
        .disclaimer h5 { color: var(--text); font-size: 0.88rem; margin-bottom: 10px; font-weight: 700; }
        .disclaimer a { color: var(--accent2); text-decoration: none; }

        /* ---- Empty state ---- */
        .empty-state { text-align: center; padding: 28px; color: var(--muted); display: none; }
        .empty-state .ico { font-size: 2.2rem; margin-bottom: 10px; }
        .empty-state p { font-size: 0.86rem; line-height: 1.6; }

        /* ---- Divider ---- */
        .divider { display: flex; align-items: center; gap: 14px; margin: 16px 0; }
        .divider span { color: var(--muted); font-size: 0.8rem; flex-shrink: 0; }
        .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

        /* ---- Footer ---- */
        footer { text-align: center; padding: 30px 0 10px; color: var(--muted); font-size: 0.8rem; }
        footer a { color: var(--accent2); text-decoration: none; }

        .card:nth-child(1){animation-delay:0.05s} .card:nth-child(2){animation-delay:0.12s} .card:nth-child(3){animation-delay:0.19s} .card:nth-child(4){animation-delay:0.26s}

        @keyframes spin    { to { transform: rotate(360deg); } }
        @keyframes fadeDown{ from{opacity:0;transform:translateY(-20px)} to{opacity:1;transform:translateY(0)} }
        @keyframes fadeUp  { from{opacity:0;transform:translateY(20px)}  to{opacity:1;transform:translateY(0)} }

        @media(max-width:480px){ .lang-bar{top:10px;right:10px} html[dir="rtl"] .lang-bar{left:10px;right:auto} .badge{font-size:0.77rem;padding:6px 12px} }
    </style>
</head>
<body class="lang-en">
<div class="orb orb1"></div>
<div class="orb orb2"></div>

<!-- Language Toggle -->
<div class="lang-bar">
    <button class="lang-btn active" onclick="setLang('en')">EN</button>
    <button class="lang-btn"        onclick="setLang('ar')">Ø¹Ø±Ø¨ÙŠ</button>
</div>

<div class="container">

    <!-- HEADER -->
    <header>
        <div class="logo-badge">
            <span class="live-dot"></span>
            <span class="en">DeFi RESCUE â€” Free &amp; Open Source</span>
            <span class="ar">DeFi RESCUE â€” Ù…Ø¬Ø§Ù†ÙŠØ© ÙˆÙ…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø±</span>
        </div>
        <h1>
            <span class="en-block">Recover Your Locked<br>DeFi Funds</span>
            <span class="ar-block">Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø£Ù…ÙˆØ§Ù„Ùƒ<br>Ù…Ù† Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ø°ÙƒÙŠØ©</span>
        </h1>
        <p class="subtitle">
            <span class="en">Project website gone? Your funds are still on the blockchain. We help you reach them safely â€” directly and for free.</span>
            <span class="ar">Ø§Ø®ØªÙÙ‰ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŸ Ø£Ù…ÙˆØ§Ù„Ùƒ Ù„Ø§ ØªØ²Ø§Ù„ ÙÙŠ Ø§Ù„Ø¨Ù„ÙˆÙƒØªØ´ÙŠÙ†. Ø³Ø§Ø¹Ø¯Ùƒ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ ÙˆØ¨Ø£Ù…Ø§Ù†.</span>
        </p>
        <div class="trust-strip">
            <div class="badge"><span class="dot"></span><span class="en">No private keys</span><span class="ar">Ø¨Ø¯ÙˆÙ† Ù…ÙØªØ§Ø­ Ø®Ø§Øµ</span></div>
            <div class="badge"><span class="dot"></span><span class="en">100% Free</span><span class="ar">Ù…Ø¬Ø§Ù†ÙŠØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</span></div>
            <div class="badge"><span class="dot"></span><span class="en">Open Source</span><span class="ar">Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø±</span></div>
            <div class="badge"><span class="dot"></span><span class="en">No upfront fees</span><span class="ar">Ù„Ø§ Ø±Ø³ÙˆÙ… Ù…Ø³Ø¨Ù‚Ø©</span></div>
        </div>
    </header>

    <!-- INFO BANNER -->
    <div class="info-banner">
        <div class="ico">â„¹ï¸</div>
        <div>
            <h4><span class="en">How does this work?</span><span class="ar">ÙƒÙŠÙ ØªØ¹Ù…Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø©ØŸ</span></h4>
            <p>
                <span class="en">Connects directly to the smart contract and calls publicly available withdrawal functions. <strong style="color:var(--warn)">No fees charged upfront.</strong> Optional donation only after a successful withdrawal.</span>
                <span class="ar">ØªØªØµÙ„ Ù…Ø¨Ø§Ø´Ø±Ø©Ù‹ Ø¨Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø°ÙƒÙŠ ÙˆØªØ³ØªØ¯Ø¹ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ù„Ù†Ù‹Ø§. <strong style="color:var(--warn)">Ù„Ø§ Ø±Ø³ÙˆÙ… ØªÙØ¯ÙØ¹ Ù…Ø³Ø¨Ù‚Ù‹Ø§.</strong> Ø§Ù„ØªØ¨Ø±Ø¹ Ø§Ø®ØªÙŠØ§Ø±ÙŠ ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.</span>
            </p>
        </div>
    </div>

    <!-- STEP 1: NETWORK -->
    <div class="card">
        <div class="card-header">
            <div class="step-num" id="step1num">1</div>
            <div>
                <h2><span class="en">Select Network</span><span class="ar">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¨ÙƒØ©</span></h2>
                <p><span class="en">The blockchain where your contract lives</span><span class="ar">Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„ØªÙŠ ÙŠÙˆØ¬Ø¯ ÙÙŠÙ‡Ø§ Ø¹Ù‚Ø¯Ùƒ</span></p>
            </div>
        </div>
        <div class="network-grid">
            <button class="net-btn active" onclick="selectNetwork(this,'bsc')"><span class="net-icon">ğŸŸ¡</span>BSC / BNB</button>
            <button class="net-btn"        onclick="selectNetwork(this,'eth')"><span class="net-icon">ğŸ”·</span>Ethereum</button>
            <button class="net-btn"        onclick="selectNetwork(this,'poly')"><span class="net-icon">ğŸŸ£</span>Polygon</button>
        </div>
    </div>

    <!-- STEP 2: CONNECT -->
    <div class="card">
        <div class="card-header">
            <div class="step-num" id="step2num">2</div>
            <div>
                <h2><span class="en">Connect Wallet</span><span class="ar">Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©</span></h2>
                <p><span class="en">MetaMask or any compatible wallet</span><span class="ar">MetaMask Ø£Ùˆ Ø£ÙŠ Ù…Ø­ÙØ¸Ø© Ù…ØªÙˆØ§ÙÙ‚Ø©</span></p>
            </div>
        </div>
        <button id="connectBtn" class="btn btn-primary" onclick="connectWallet()">
            ğŸ”— <span class="en">Connect Wallet</span><span class="ar">Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©</span>
        </button>
        <div id="walletInfo" class="wallet-info">
            <div class="wallet-row">
                <span class="wallet-label"><span class="en">Address</span><span class="ar">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</span></span>
                <span class="wallet-value" id="walletAddress">â€”</span>
            </div>
            <div class="wallet-row">
                <span class="wallet-label"><span class="en">Balance</span><span class="ar">Ø§Ù„Ø±ØµÙŠØ¯</span></span>
                <span class="wallet-value" id="balance">â€”</span>
            </div>
            <div class="wallet-row">
                <span class="wallet-label"><span class="en">Network</span><span class="ar">Ø§Ù„Ø´Ø¨ÙƒØ©</span></span>
                <span class="wallet-value" id="connectedNetwork">â€”</span>
            </div>
        </div>
    </div>

    <!-- STEP 3: CONTRACT -->
    <div class="card">
        <div class="card-header">
            <div class="step-num" id="step3num">3</div>
            <div>
                <h2><span class="en">Identify the Contract</span><span class="ar">Ø­Ø¯Ø¯ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ø°ÙƒÙŠ</span></h2>
                <p><span class="en">Enter manually or scan your history</span><span class="ar">Ø£Ø¯Ø®Ù„ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ùˆ Ø§Ø³ØªØ¹Ø±Ø¶ Ø³Ø¬Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙƒ</span></p>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label"><span class="en">Contract Address</span><span class="ar">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ù‚Ø¯</span></label>
            <input type="text" id="contractInput" placeholder="0x..." oninput="onContractInput()" />
        </div>

        <div class="divider"><span class="en">or</span><span class="ar">Ø£Ùˆ</span></div>

        <button id="scanBtn" class="btn btn-outline" disabled onclick="scanHistory()">
            ğŸ” <span class="en">Scan My Transaction History</span><span class="ar">Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø³Ø¬Ù„ Ù…Ø¹Ø§Ù…Ù„Ø§ØªÙŠ</span>
        </button>

        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p><span class="en">Scanning transaction history...</span><span class="ar">Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª...</span></p>
        </div>
        <div id="emptyState" class="empty-state">
            <div class="ico">ğŸ“­</div>
            <p><span class="en">No contracts found in recent transactions.<br>Enter the address manually above.</span><span class="ar">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù‚ÙˆØ¯.<br>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø£Ø¹Ù„Ø§Ù‡.</span></p>
        </div>
        <div id="contractList" class="contract-list"></div>
    </div>

    <!-- STEP 4: EXECUTE -->
    <div id="executeCard" class="card" style="display:none;">
        <div class="card-header">
            <div class="step-num">4</div>
            <div>
                <h2><span class="en">Execute Withdrawal</span><span class="ar">ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø­Ø¨</span></h2>
                <p><span class="en">Choose the right function and proceed</span><span class="ar">Ø§Ø®ØªØ± Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</span></p>
            </div>
        </div>

        <div class="input-group">
            <label class="input-label"><span class="en">Target Contract</span><span class="ar">Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</span></label>
            <input type="text" id="targetDisplay" readonly style="background:var(--bg);color:var(--accent2);font-family:'Space Mono',monospace;font-size:0.75rem;" />
        </div>

        <div class="input-group">
            <label class="input-label"><span class="en">Withdrawal Function</span><span class="ar">Ø¯Ø§Ù„Ø© Ø§Ù„Ø³Ø­Ø¨</span></label>
            <select id="functionSelect" onchange="estimateGas()">
                <option value="emergencyWithdraw">emergencyWithdraw() â€” Emergency</option>
                <option value="withdraw">withdraw() â€” Standard</option>
                <option value="claim">claim() â€” Claim Rewards</option>
                <option value="exit">exit() â€” Full Exit</option>
                <option value="getReward">getReward() â€” Get Earnings</option>
            </select>
        </div>

        <div class="input-group">
            <label class="input-label"><span class="en">Pool ID (leave 0 if unsure)</span><span class="ar">Pool ID (Ø§ØªØ±ÙƒÙ‡ 0 Ø¥Ø°Ø§ Ù„Ù… ØªØ¹Ø±Ù)</span></label>
            <input type="number" id="poolIdInput" value="0" min="0" onchange="estimateGas()" />
        </div>

        <div class="fee-box">
            <h4>ğŸ’¡ <span class="en">Transaction Details â€” Full Transparency</span><span class="ar">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© â€” Ø´ÙØ§ÙÙŠØ© ÙƒØ§Ù…Ù„Ø©</span></h4>
            <div class="fee-row">
                <span class="fee-key"><span class="en">Tool Fee</span><span class="ar">Ø±Ø³ÙˆÙ… Ø§Ù„Ø£Ø¯Ø§Ø©</span></span>
                <span class="fee-val" style="color:var(--accent)"><span class="en">FREE âœ“</span><span class="ar">Ù…Ø¬Ø§Ù†ÙŠØ© âœ“</span></span>
            </div>
            <div class="fee-row">
                <span class="fee-key"><span class="en">Network Gas</span><span class="ar">Gas (Ø±Ø³ÙˆÙ… Ø§Ù„Ø´Ø¨ÙƒØ©)</span></span>
                <span class="fee-val" id="gasEstimate">â€”</span>
            </div>
            <div class="fee-row">
                <span class="fee-key"><span class="en">Paid upfront</span><span class="ar">Ù…Ø§ ÙŠÙØ¯ÙØ¹ Ù…Ø³Ø¨Ù‚Ù‹Ø§</span></span>
                <span class="fee-val" style="color:#fff"><span class="en">Gas only (to network)</span><span class="ar">Gas ÙÙ‚Ø· (Ù„Ù„Ø´Ø¨ÙƒØ©)</span></span>
            </div>
        </div>

        <button id="executeBtn" class="btn btn-primary" onclick="executeWithdraw()">
            âš¡ <span class="en">Execute Withdrawal Now</span><span class="ar">ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¢Ù†</span>
        </button>

        <div id="executeStatus" class="status-msg"></div>

        <!-- Optional Donation -->
        <div id="donateSection" class="donate-section" style="display:none;">
            <h4>ğŸ‰ <span class="en">Withdrawal Successful!</span><span class="ar">ØªÙ… Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!</span></h4>
            <p>
                <span class="en">Did this tool help you? Support it with an optional donation â€” you pick the amount. Completely voluntary.</span>
                <span class="ar">Ù‡Ù„ Ø£Ø¹Ø¬Ø¨ØªÙƒ Ø§Ù„Ø£Ø¯Ø§Ø©ØŸ ÙŠÙ…ÙƒÙ†Ùƒ Ø¯Ø¹Ù…Ù†Ø§ Ø¨ØªØ¨Ø±Ø¹ Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” Ø£Ù†Øª ØªØ®ØªØ§Ø± Ø§Ù„Ù…Ø¨Ù„Øº. ØºÙŠØ± Ø¥Ù„Ø²Ø§Ù…ÙŠ ØªÙ…Ø§Ù…Ù‹Ø§.</span>
            </p>
            <!-- Visible wallet address -->
            <div style="background:var(--surface2); border:1px solid var(--border); border-radius:10px; padding:12px 16px; margin-bottom:14px; text-align:center;">
                <div style="font-size:0.75rem; color:var(--muted); margin-bottom:6px;">
                    <span class="en">Donation wallet address</span>
                    <span class="ar">Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ÙØ¸Ø© Ø§Ù„ØªØ¨Ø±Ø¹</span>
                </div>
                <div style="font-family:'Space Mono',monospace; font-size:0.72rem; color:var(--accent2); word-break:break-all; line-height:1.6;">
                    0xEc64E45fC0801A32c066337A284F3711Ca8300e6
                </div>
                <button onclick="copyWallet(this)" style="margin-top:8px; background:transparent; border:1px solid var(--border); border-radius:6px; padding:5px 14px; color:var(--muted); font-size:0.75rem; cursor:pointer; transition:all 0.2s;">
                    <span class="en">ğŸ“‹ Copy</span><span class="ar">ğŸ“‹ Ù†Ø³Ø®</span>
                </button>
            </div>

            <select id="donateAmount" style="margin-bottom:6px;">
                <option value="0.001">0.001 â€” Symbolic / Ø±Ù…Ø²ÙŠ</option>
                <option value="0.003" selected>0.003 â€” Thank you! / Ø´ÙƒØ±Ù‹Ø§</option>
                <option value="0.005">0.005 â€” Generous! / Ø³Ø®ÙŠ!</option>
                <option value="0">No thanks / Ù„Ø§ Ø´ÙƒØ±Ù‹Ø§</option>
            </select>
            <button class="btn-donate" id="donateBtn" onclick="sendDonation()">
                <span class="en">Send Optional Donation</span><span class="ar">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¨Ø±Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span>
            </button>
            <div id="donateStatus" class="status-msg"></div>
        </div>
    </div>

    <!-- DISCLAIMER -->
    <div class="disclaimer">
        <h5><span class="en">âš ï¸ Important â€” Read Before Using</span><span class="ar">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù… â€” Ø§Ù‚Ø±Ø£ Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span></h5>
        <div class="en-block">
            â€¢ This tool interacts with blockchain smart contracts. <strong>We bear no responsibility for losses</strong> from broken or fraudulent contracts.<br>
            â€¢ Always verify the contract on <a href="https://bscscan.com" target="_blank">BscScan</a>, <a href="https://etherscan.io" target="_blank">Etherscan</a>, or <a href="https://polygonscan.com" target="_blank">Polygonscan</a> before executing.<br>
            â€¢ Some contracts have time locks or withdrawal conditions â€” failure â‰  tool bug.<br>
            â€¢ <strong>Never share your private keys with any tool.</strong> This tool never asks for them.
        </div>
        <div class="ar-block">
            â€¢ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© ØªØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø¹Ù‚ÙˆØ¯ Ø°ÙƒÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ù„ÙˆÙƒØªØ´ÙŠÙ†. <strong>Ù„Ø§ Ù†ØªØ­Ù…Ù„ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø£ÙŠ Ø®Ø³Ø§Ø¦Ø±</strong> Ù…Ù† Ø¹Ù‚ÙˆØ¯ Ù…Ø¹Ø·ÙˆØ¨Ø© Ø£Ùˆ Ø§Ø­ØªÙŠØ§Ù„ÙŠØ©.<br>
            â€¢ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯ Ø¹Ø¨Ø± <a href="https://bscscan.com" target="_blank">BscScan</a> Ø£Ùˆ <a href="https://etherscan.io" target="_blank">Etherscan</a> Ù‚Ø¨Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°.<br>
            â€¢ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù‚ÙˆØ¯ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‚ÙÙ„ Ø²Ù…Ù†ÙŠ â€” Ø§Ù„ÙØ´Ù„ Ù„Ø§ ÙŠØ¹Ù†ÙŠ ÙˆØ¬ÙˆØ¯ Ø®Ù„Ù„ ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø©.<br>
            â€¢ <strong>Ù„Ø§ ØªØ±Ø³Ù„ Ù…ÙØ§ØªÙŠØ­Ùƒ Ø§Ù„Ø®Ø§ØµØ© Ù„Ø£ÙŠ Ø£Ø¯Ø§Ø©.</strong> Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø¯Ø§Ø© Ù„Ø§ ØªØ·Ù„Ø¨Ù‡Ø§ Ø¥Ø·Ù„Ø§Ù‚Ù‹Ø§.
        </div>
    </div>

    <footer>
        <p>DeFi Rescue â€” Free &amp; Open Source | Built by Houari Boulares</p>
        <p style="margin-top:6px;">
            <span class="en">No upfront fees Â· No data collection Â· Open code</span>
            <span class="ar">Ù„Ø§ Ø±Ø³ÙˆÙ… Ù…Ø³Ø¨Ù‚Ø© Â· Ù„Ø§ Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Â· ÙƒÙˆØ¯ Ù…ÙØªÙˆØ­</span>
        </p>
    </footer>
</div>

<script>
// ============================
// LANGUAGE
// ============================
let currentLang = 'en';

function setLang(lang) {
    currentLang = lang;
    document.documentElement.lang = lang;
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.body.className = `lang-${lang}`;
    document.querySelectorAll('.lang-btn').forEach(btn => {
        const isEn = btn.textContent.trim() === 'EN';
        btn.classList.toggle('active', lang === 'en' ? isEn : !isEn);
    });
}

// ============================
// NETWORKS
// ============================
const NETWORKS = {
    bsc:  { name:"BSC / BNB Chain", chainId:"0x38", symbol:"BNB",   scan:"https://api.bscscan.com/api",     scanKey:"9X7377VVGNKKWX71IZP8C7PARZNSQWAXRB" },
    eth:  { name:"Ethereum",         chainId:"0x1",  symbol:"ETH",   scan:"https://api.etherscan.io/api",    scanKey:"S141HEFMBD7Y7X4E16D62U6XKN9YU9HFFZ" },
    poly: { name:"Polygon",          chainId:"0x89", symbol:"MATIC", scan:"https://api.polygonscan.com/api", scanKey:"S141HEFMBD7Y7X4E16D62U6XKN9YU9HFFZ" }
};
const DONATION_WALLET = "0xEc64E45fC0801A32c066337A284F3711Ca8300e6";

let provider, signer, userAddress;
let selectedNetwork = NETWORKS.bsc;
let selectedContract = null;

// ============================
// NETWORK SELECT
// ============================
function selectNetwork(btn, key) {
    document.querySelectorAll('.net-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedNetwork = NETWORKS[key];
}

// ============================
// CONNECT WALLET
// ============================
async function connectWallet() {
    if (!window.ethereum) {
        showStatus('executeStatus', 'error',
            currentLang === 'en' ? 'MetaMask not detected. Please install it first.' : 'MetaMask ØºÙŠØ± Ù…Ø«Ø¨ØªØ©. ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØªÙ‡Ø§ Ø£ÙˆÙ„Ù‹Ø§.');
        return;
    }
    try {
        const wp = window.ethereum.providers?.find(p => p.isMetaMask) || window.ethereum;
        await wp.request({ method: 'eth_requestAccounts' });
        try { await wp.request({ method:'wallet_switchEthereumChain', params:[{chainId: selectedNetwork.chainId}] }); } catch(e){}

        provider = new ethers.providers.Web3Provider(wp);
        signer   = provider.getSigner();
        userAddress = await signer.getAddress();

        const bal = await provider.getBalance(userAddress);
        const net = await provider.getNetwork();

        document.getElementById('walletAddress').textContent    = userAddress.slice(0,6)+'...'+userAddress.slice(-4);
        document.getElementById('balance').textContent          = parseFloat(ethers.utils.formatEther(bal)).toFixed(4)+' '+selectedNetwork.symbol;
        document.getElementById('connectedNetwork').textContent = net.name || 'Chain '+net.chainId;
        document.getElementById('walletInfo').style.display     = 'block';

        const cb = document.getElementById('connectBtn');
        cb.innerHTML = 'âœ… <span class="en">Connected</span><span class="ar">Ù…ØªØµÙ„</span>';
        setLang(currentLang);
        cb.disabled = true;
        document.getElementById('scanBtn').disabled = false;
        markDone('step2num');
    } catch(err) {
        alert((currentLang==='en'?'Connection failed: ':'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„: ')+(err.message||''));
    }
}

// ============================
// MANUAL INPUT
// ============================
function onContractInput() {
    const val = document.getElementById('contractInput').value.trim();
    if (ethers.utils.isAddress(val)) {
        selectedContract = val;
        document.getElementById('targetDisplay').value = val;
        document.getElementById('executeCard').style.display = 'block';
        markDone('step3num');
        estimateGas();
    }
}

function markDone(id) {
    const el = document.getElementById(id);
    el.classList.add('done');
    el.textContent = 'âœ“';
}

// ============================
// SCAN HISTORY
// ============================
async function scanHistory() {
    if (!userAddress) return;
    const loader = document.getElementById('loading');
    const list   = document.getElementById('contractList');
    const empty  = document.getElementById('emptyState');

    loader.style.display = 'block';
    list.innerHTML = '';
    empty.style.display = 'none';

    try {
        const { scan, scanKey } = selectedNetwork;
        const url = `${scan}?module=account&action=txlist&address=${userAddress}&startblock=0&endblock=99999999&sort=desc&apikey=${scanKey}`;
        const res  = await fetch(url);
        const data = await res.json();

        if (data.status === "1" && data.result?.length) {
            const unique = [...new Set(
                data.result.filter(tx => tx.to && tx.input && tx.input !== '0x').map(tx => tx.to.toLowerCase())
            )].slice(0, 10);

            if (!unique.length) { empty.style.display = 'block'; return; }

            unique.forEach(addr => {
                const item = document.createElement('div');
                item.className = 'contract-item';
                item.innerHTML = `
                    <div>
                        <div class="contract-lbl">${currentLang==='en'?'Smart Contract':'Ø¹Ù‚Ø¯ Ø°ÙƒÙŠ'}</div>
                        <div class="contract-addr">${addr}</div>
                    </div>
                    <span class="contract-arrow">â€º</span>`;
                item.onclick = () => {
                    document.querySelectorAll('.contract-item').forEach(i => i.classList.remove('selected'));
                    item.classList.add('selected');
                    selectedContract = addr;
                    document.getElementById('contractInput').value = addr;
                    document.getElementById('targetDisplay').value = addr;
                    document.getElementById('executeCard').style.display = 'block';
                    markDone('step3num');
                    estimateGas();
                    document.getElementById('executeCard').scrollIntoView({ behavior:'smooth' });
                };
                list.appendChild(item);
            });
        } else { empty.style.display = 'block'; }
    } catch(e) { console.error(e); empty.style.display = 'block'; }
    finally { loader.style.display = 'none'; }
}

// ============================
// GAS ESTIMATE
// ============================
async function estimateGas() {
    if (!signer || !selectedContract) return;
    const funcName = document.getElementById('functionSelect').value;
    const poolId   = parseInt(document.getElementById('poolIdInput').value || '0');
    const gasEl    = document.getElementById('gasEstimate');
    gasEl.textContent = currentLang==='en' ? 'Calculating...' : 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø³Ø§Ø¨...';
    try {
        const abi      = [`function ${funcName}() public`, `function ${funcName}(uint256) public`];
        const contract = new ethers.Contract(selectedContract, abi, signer);
        let est;
        try { est = await contract.estimateGas[funcName](poolId); }
        catch { est = await contract.estimateGas[funcName](); }
        const gp   = await provider.getGasPrice();
        const cost = parseFloat(ethers.utils.formatEther(est.mul(gp))).toFixed(6);
        gasEl.textContent = `â‰ˆ ${cost} ${selectedNetwork.symbol}`;
    } catch {
        gasEl.textContent = currentLang==='en' ? 'Auto-calculated on confirm' : 'Ø³ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§';
    }
}

// ============================
// EXECUTE
// ============================
async function executeWithdraw() {
    if (!signer || !selectedContract) {
        showStatus('executeStatus','error', currentLang==='en'?'Please connect your wallet and select a contract first.':'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù‚Ø¯ Ø£ÙˆÙ„Ù‹Ø§.');
        return;
    }
    const funcName = document.getElementById('functionSelect').value;
    const poolId   = parseInt(document.getElementById('poolIdInput').value || '0');
    const btn      = document.getElementById('executeBtn');

    btn.disabled  = true;
    btn.innerHTML = (currentLang==='en' ? 'â³ Processing...' : 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°...');
    showStatus('executeStatus','info', currentLang==='en'?'Please confirm the transaction in your wallet...':'Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© ÙÙŠ Ù…Ø­ÙØ¸ØªÙƒ...');

    try {
        const abi      = [`function ${funcName}() public`, `function ${funcName}(uint256 _pid) public`];
        const contract = new ethers.Contract(selectedContract, abi, signer);
        let tx;
        try { tx = await contract[funcName](poolId); } catch { tx = await contract[funcName](); }

        showStatus('executeStatus','info', (currentLang==='en'?'ğŸ“¡ Transaction sent: ':'ğŸ“¡ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ù…Ø±Ø³Ù„Ø©: ')+tx.hash.slice(0,10)+'...');
        await tx.wait();

        showStatus('executeStatus','success',
            (currentLang==='en'?'âœ… Withdrawal successful!\nğŸ”— Tx Hash: ':'âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­!\nğŸ”— Hash: ')+tx.hash);

        btn.innerHTML = 'âœ… '+(currentLang==='en'?'Done!':'ØªÙ…!');
        document.getElementById('donateSection').style.display = 'block';
        document.getElementById('donateSection').scrollIntoView({ behavior:'smooth' });
    } catch(err) {
        const msg = err?.reason||err?.data?.message||err?.message||(currentLang==='en'?'Transaction failed':'ÙØ´Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©');
        showStatus('executeStatus','error',
            currentLang==='en'
                ? `âŒ Execution failed: ${msg}\n\nTry a different function or verify your withdrawal rights for this contract.`
                : `âŒ ÙØ´Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: ${msg}\n\nØ¬Ø±Ø¨ Ø¯Ø§Ù„Ø© Ù…Ø®ØªÙ„ÙØ© Ø£Ùˆ ØªØ£ÙƒØ¯ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØªÙƒ Ù„Ù„Ø³Ø­Ø¨ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù‚Ø¯.`);
        btn.disabled  = false;
        btn.innerHTML = 'âš¡ '+(currentLang==='en'?'Execute Withdrawal Now':'ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø¢Ù†');
    }
}

// ============================
// DONATION
// ============================
async function sendDonation() {
    const amount = document.getElementById('donateAmount').value;
    const btn    = document.getElementById('donateBtn');

    if (amount === '0') {
        showStatus('donateStatus','success',
            currentLang==='en'?'âœ… No problem! The tool stays free for everyone. Good luck! ğŸ‰':'âœ… Ù„Ø§ Ù…Ø´ÙƒÙ„Ø©! Ø§Ù„Ø£Ø¯Ø§Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§. Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚! ğŸ‰');
        btn.disabled = true; return;
    }
    if (!signer) {
        showStatus('donateStatus','error', currentLang==='en'?'Please connect your wallet first.':'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£ÙˆÙ„Ù‹Ø§.');
        return;
    }
    btn.disabled   = true;
    btn.textContent = currentLang==='en'?'â³ Sending...':'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
    try {
        const tx = await signer.sendTransaction({ to: DONATION_WALLET, value: ethers.utils.parseEther(amount) });
        await tx.wait();
        showStatus('donateStatus','success',
            currentLang==='en'
                ? `ğŸ™ Thank you! Your donation (${amount} ${selectedNetwork.symbol}) was received.`
                : `ğŸ™ Ø´ÙƒØ±Ù‹Ø§ Ø¬Ø²ÙŠÙ„Ù‹Ø§! ØªØ¨Ø±Ø¹Ùƒ (${amount} ${selectedNetwork.symbol}) ÙˆØµÙ„ Ø¨Ù†Ø¬Ø§Ø­.`);
        btn.textContent = 'âœ… '+(currentLang==='en'?'Thank you!':'Ø´ÙƒØ±Ù‹Ø§!');
    } catch {
        showStatus('donateStatus','error', currentLang==='en'?'Donation not sent. No worries!':'Ù„Ù… ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¨Ø±Ø¹. Ù„Ø§ Ù…Ø´ÙƒÙ„Ø©!');
        btn.disabled   = false;
        btn.textContent = currentLang==='en'?'Send Optional Donation':'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ¨Ø±Ø¹ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠ';
    }
}

// ============================
// COPY WALLET
// ============================
function copyWallet(btn) {
    navigator.clipboard.writeText(DONATION_WALLET).then(() => {
        const orig = btn.innerHTML;
        btn.innerHTML = 'âœ… <span class="en">Copied!</span><span class="ar">ØªÙ… Ø§Ù„Ù†Ø³Ø®!</span>';
        btn.style.borderColor = 'var(--accent)';
        btn.style.color = 'var(--accent)';
        setLang(currentLang);
        setTimeout(() => { btn.innerHTML = orig; btn.style.borderColor = ''; btn.style.color = ''; setLang(currentLang); }, 2000);
    });
}

// ============================
// HELPER
// ============================
function showStatus(id, type, msg) {
    const el = document.getElementById(id);
    el.style.display = 'block';
    el.className     = `status-msg ${type}`;
    el.textContent   = msg;
}
</script>
</body>
</html>
