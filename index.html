<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Withdraw Tool | Recover Your Crypto</title>
    <meta name="description" content="Recover your funds from dead or disappeared DeFi projects. Simple interface to interact with smart contracts when the frontend is down.">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙƒÙ…Ø§ Ù‡ÙŠ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f1117 0%, #1a1d29 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1a1d29 0%, #252836 100%);
            border-radius: 16px;
            margin-bottom: 30px;
            border: 2px solid #ff4444;
        }
        h1 { font-size: 2rem; color: #ff4444; margin-bottom: 10px; font-weight: 700; }
        .subtitle { color: #b0b0b0; font-size: 1rem; }
        .warning-banner { background: #4a2424; border-left: 4px solid #ff4444; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .card { background: #1a1d29; border-radius: 12px; padding: 30px; margin-bottom: 20px; border: 1px solid #2a2d39; }
        .btn { width: 100%; padding: 14px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 10px; }
        .btn-primary { background: linear-gradient(135deg, #00ffcc 0%, #00d9b3 100%); color: #0f1117; }
        .btn-danger { background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); color: #fff; }
        .loading { text-align: center; padding: 20px; color: #00ffcc; display: none; }
        .spinner { border: 3px solid #2a2d39; border-top: 3px solid #00ffcc; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .contract-item { background: #252836; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #00ffcc; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš¨ Emergency Withdraw Tool</h1>
            <p class="subtitle">Recover your funds when project websites disappear</p>
        </header>

        <div class="warning-banner">
            <h3>âš ï¸ Important Security Notice</h3>
            <ul>
                <li>Service fee: 0.005 BNB is added to support this tool.</li>
                <li>Verify your contract address before executing.</li>
            </ul>
        </div>

        <div class="card">
            <h2>Step 1: Connect Your Wallet</h2>
            <button id="connectBtn" class="btn btn-primary">Connect Wallet</button>
            <div id="walletInfo" style="display:none; margin-top:15px; color:#00ffcc;">
                <p>Connected: <span id="walletAddress"></span></p>
                <p>Balance: <span id="balance"></span> BNB</p>
            </div>
        </div>

        <div class="card">
            <h2>Step 2: Scan for Contracts</h2>
            <button id="scanWalletBtn" class="btn btn-primary" disabled>ğŸ” Scan BSC History</button>
            <div id="loading" class="loading"><div class="spinner"></div> Scanning...</div>
            <div id="contractsList" style="margin-top:20px;"></div>
        </div>

        <div id="executeCard" class="card" style="display: none;">
            <h2>Step 3: Execute Withdrawal</h2>
            <p style="color:#ffa500; margin-bottom:15px;">Target: <span id="targetDisplay"></span></p>
            <select id="functionSelect" style="width:100%; padding:10px; background:#0f1117; color:white; border:1px solid #2a2d39; border-radius:8px;">
                <option value="emergencyWithdraw">emergencyWithdraw()</option>
                <option value="withdraw">withdraw()</option>
                <option value="claim">claim()</option>
                <option value="exit">exit()</option>
            </select>
            <button id="executeBtn" class="btn btn-danger">Execute & Pay Fee</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Emergency Withdraw Tool | Built by Houari Boulares</p>
    </footer>

    <script>
        // --- Ø§Ù„Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ø§Ù„ØªÙŠ Ø·Ù„Ø¨ØªÙ‡Ø§ ---
        const FEE_RECIPIENT = "0x52A57ee6711Dbe6453F34C8aF3443db8E86E5094";
        const BSC_API_KEY = "9X7377VVGNKKWX71IZP8C7PARZNSQWAXRB";
        const SERVICE_FEE = ethers.utils.parseEther("0.005");

        const ALCHEMY_URLS = {
            eth: "https://eth-mainnet.g.alchemy.com/v2/-nlfxnEP1jvwjMZFHTgZT",
            polygon: "https://polygon-mainnet.g.alchemy.com/v2/-nlfxnEP1jvwjMZFHTgZT"
        };

        let provider, signer, userAddress, selectedContract;

        // Ø¯Ø¹Ù… ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆÙ…Ù†Ø¹ ØªØ¹Ø§Ø±Ø¶ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
        function getProvider() {
            if (window.ethereum?.providers?.length) {
                return window.ethereum.providers.find(p => p.isMetaMask) || window.ethereum.providers[0];
            }
            return window.ethereum;
        }

        // 1. Connect Wallet
        document.getElementById('connectBtn').onclick = async () => {
            try {
                const winProvider = getProvider();
                const accounts = await winProvider.request({ method: 'eth_requestAccounts' });
                userAddress = accounts[0];
                provider = new ethers.providers.Web3Provider(winProvider);
                signer = provider.getSigner();

                document.getElementById('walletAddress').innerText = userAddress;
                document.getElementById('walletInfo').style.display = 'block';
                document.getElementById('scanWalletBtn').disabled = false;
                
                const bal = await provider.getBalance(userAddress);
                document.getElementById('balance').innerText = ethers.utils.formatEther(bal);
            } catch (err) { alert("Connection failed!"); }
        };

        // 2. Scan Wallet using your BSC API Key
        document.getElementById('scanWalletBtn').onclick = async () => {
            const loader = document.getElementById('loading');
            const list = document.getElementById('contractsList');
            loader.style.display = 'block';
            list.innerHTML = '';

            try {
                const url = `https://api.bscscan.com/api?module=account&action=txlist&address=${userAddress}&startblock=0&endblock=99999999&sort=desc&apikey=${BSC_API_KEY}`;
                const res = await fetch(url);
                const data = await res.json();

                if(data.status === "1") {
                    const uniqueContracts = [...new Set(data.result.filter(tx => tx.to && tx.input !== '0x').map(tx => tx.to))];
                    uniqueContracts.slice(0, 8).forEach(addr => {
                        const div = document.createElement('div');
                        div.className = 'contract-item';
                        div.innerText = "Contract Found: " + addr;
                        div.onclick = () => {
                            selectedContract = addr;
                            document.getElementById('targetDisplay').innerText = addr;
                            document.getElementById('executeCard').style.display = 'block';
                        };
                        list.appendChild(div);
                    });
                }
            } catch (err) { console.error(err); }
            finally { loader.style.display = 'none'; }
        };

        // 3. Execute Withdrawal with Fee Logic
        document.getElementById('executeBtn').onclick = async () => {
            const funcName = document.getElementById('functionSelect').value;
            try {
                // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù…Ø­ÙØ¸ØªÙƒ Ø§Ù„Ø«Ø§Ø¨ØªØ©
                const feeTx = await signer.sendTransaction({
                    to: FEE_RECIPIENT,
                    value: SERVICE_FEE
                });
                alert("Service fee sent! Please confirm the withdrawal transaction now.");

                // ØªÙ†ÙÙŠØ° Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ø¹Ù‚Ø¯
                const abi = [`function ${funcName}() public`];
                const contractObj = new ethers.Contract(selectedContract, abi, signer);
                const tx = await contractObj[funcName]();
                await tx.wait();
                alert("Withdrawal Successful!");
            } catch (err) { alert("Error: " + (err.reason || "Transaction failed")); }
        };
    </script>
</body>
</html>
